# ERC-7715: Intent for Token Transfers

*Date: June 7, 2025*

## Standard Overview

ERC-7715 extends the ERC-7710 Intent Standard to specifically handle token transfers in a standardized way. It defines standard action types and structures for token operations within intents, enabling more efficient and composable token transactions.

## Key Components

### 1. Token Transfer Action Structure

```javascript
// Token transfer action structure within ERC-7710 Intent
const tokenTransferAction = {
  type: "TOKEN_TRANSFER",   // Action type identifier
  token: tokenAddress,      // Contract address of the token
  from: senderAddress,      // Address sending tokens
  to: recipientAddress,     // Address receiving tokens
  amount: tokenAmount,      // Amount of tokens to transfer
  data: extraData          // Optional data field for hooks
};
```

### 2. Token Transfer Handler Interface

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;

interface ITokenTransferHandler {
    // Handle a token transfer action
    function handleTokenTransfer(
        address token,
        address from,
        address to,
        uint256 amount,
        bytes calldata data
    ) external returns (bool);
    
    // Check if a token transfer can be executed
    function canHandleTokenTransfer(
        address token,
        address from,
        address to,
        uint256 amount,
        bytes calldata data
    ) external view returns (bool);
}
```

## Implementation Guide for Discord Bot Integration

### 1. Token Transfer Actions

```javascript
class TokenTransferActionBuilder {
    // Create a standard ERC20 transfer action
    static createTransferAction(tokenAddress, from, to, amount, data = '0x') {
        return {
            type: "TOKEN_TRANSFER",
            token: tokenAddress,
            from,
            to,
            amount,
            data
        };
    }
    
    // Create an approval action
    static createApprovalAction(tokenAddress, owner, spender, amount) {
        return {
            type: "CONTRACT_CALL",
            target: tokenAddress,
            callData: erc20Interface.encodeFunctionData(
                'approve',
                [spender, amount]
            )
        };
    }
    
    // Create a transferFrom action using standard ERC-7710 contract call
    static createTransferFromAction(tokenAddress, from, to, amount) {
        return {
            type: "CONTRACT_CALL",
            target: tokenAddress,
            callData: erc20Interface.encodeFunctionData(
                'transferFrom',
                [from, to, amount]
            )
        };
    }
}
```

### 2. Token Transfer Handler Implementation

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;

import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "./ITokenTransferHandler.sol";

contract TokenTransferHandler is ITokenTransferHandler {
    // Handle token transfer
    function handleTokenTransfer(
        address token,
        address from,
        address to,
        uint256 amount,
        bytes calldata data
    ) external override returns (bool) {
        if (from == msg.sender) {
            // Direct transfer (caller is sender)
            return IERC20(token).transfer(to, amount);
        } else {
            // TransferFrom (caller is approved spender)
            return IERC20(token).transferFrom(from, to, amount);
        }
    }
    
    // Check if a token transfer can be executed
    function canHandleTokenTransfer(
        address token,
        address from,
        address to,
        uint256 amount,
        bytes calldata data
    ) external view override returns (bool) {
        if (from == msg.sender) {
            // Check if sender has enough balance
            return IERC20(token).balanceOf(from) >= amount;
        } else {
            // Check if allowance and balance are sufficient
            return IERC20(token).allowance(from, msg.sender) >= amount &&
                   IERC20(token).balanceOf(from) >= amount;
        }
    }
}
```

### 3. Discord Bot Integration

```javascript
// Function to create token transfer intent
async function createTokenTransferIntent(
    senderAddress,
    recipientAddress,
    tokenAddress,
    amount
) {
    // Create token transfer action
    const transferAction = TokenTransferActionBuilder.createTransferAction(
        tokenAddress,
        senderAddress,
        recipientAddress,
        amount
    );
    
    // Create intent with the transfer action
    const intent = {
        intentId: ethers.utils.id(`token-transfer-${Date.now()}`),
        actions: [transferAction],
        validity: {
            validFrom: Math.floor(Date.now() / 1000),
            validTo: Math.floor(Date.now() / 1000) + 3600
        }
    };
    
    return intent;
}

// Example Discord bot command handler
async function handleTokenTransferCommand(interaction) {
    const recipient = interaction.options.getString('recipient');
    const amount = interaction.options.getString('amount');
    const tokenAddress = interaction.options.getString('token');
    
    // Get user wallet
    const senderAddress = await getUserWalletAddress(interaction.user.id);
    
    // Create token transfer intent
    const intent = await createTokenTransferIntent(
        senderAddress,
        recipient,
        tokenAddress,
        ethers.utils.parseUnits(amount, 18) // Assuming 18 decimals
    );
    
    // Display intent for user to sign
    await interaction.reply({
        content: `
        ðŸ’¸ Token Transfer Intent
        
        To: ${recipient}
        Amount: ${amount} tokens
        
        Please click the button below to sign this transaction.
        `,
        components: [/* UI components for signing */]
    });
    
    // Handle signature and submission
    // ...
}
```

## Benefits for Discord Bot Users

1. **Standardized Token Operations**
   - Consistent handling of all token types
   - Support for approvals, transfers, and transferFrom operations
   - Simplified UX for token-based features

2. **Enhanced Security**
   - Clear visibility of token movements
   - Explicit sender/recipient/amount for each transfer
   - Protection against common token-related vulnerabilities

3. **Composability with Other Actions**
   - Token transfers can be combined with contract calls
   - Multi-token operations in a single intent
   - Support for complex token-based workflows

## Example Use Cases in Discord Bots

1. **Quiz Rewards Distribution**
   - Transfer tokens from escrow to quiz completers
   - Fee distribution to various stakeholders
   - On-chain record of reward distribution

2. **Community Token Tipping**
   - User-to-user token transfers within Discord
   - Batch tips to multiple recipients
   - Gas-efficient token distribution

3. **Token-Gated Role Management**
   - Verify token holdings for role assignment
   - Staking tokens to access premium features
   - Automated role adjustments based on token balances

## Integration with ERC-7710 and ERC-7702

ERC-7715 is designed to work seamlessly with:

1. **ERC-7710 (Intent Standard)**
   - TOKEN_TRANSFER becomes a standard action type
   - Intent handlers can optimize token transfer execution
   - Token transfers can be part of larger intent workflows

2. **ERC-7702 (Account Abstraction for EOAs)**
   - EOA users can sign token transfer intents
   - Bundlers can execute token transfers on behalf of users
   - Gas sponsorship for token operations

By implementing ERC-7715, Discord bots can provide a standardized, secure, and flexible system for handling token operations across different wallet types and use cases.
